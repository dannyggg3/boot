# ============================================
# CONFIGURACIÓN DEL SISTEMA DE TRADING AUTÓNOMO
# ============================================

# ===== SELECCIÓN DE PROVEEDOR DE IA =====
# Opciones: "deepseek", "openai", "gemini"
ai_provider: "deepseek"

# Modelos disponibles según proveedor:
# - DeepSeek: "deepseek-chat" (V3 - Rápido), "deepseek-reasoner" (R1 - Razonamiento profundo)
# - OpenAI: "gpt-4o-mini" (Rápido), "gpt-4o" (Potente), "o1-mini" (Razonamiento)
# - Gemini: "gemini-1.5-pro", "gemini-1.5-flash"
ai_model: "deepseek-chat"

# ===== ARQUITECTURA HÍBRIDA (RECOMENDADO PARA REDUCIR COSTOS) =====
# Usa dos modelos: uno rápido para filtrado, uno profundo para decisión final
ai_use_hybrid_analysis: true  # true = modo híbrido (ahorra costos), false = modelo único

# Modelo para filtrado rápido (DeepSeek-V3, gpt-4o-mini)
# Se ejecuta cada ciclo para detectar oportunidades
ai_model_fast: "deepseek-chat"

# Modelo para razonamiento profundo (DeepSeek-R1, o1-mini)
# Solo se ejecuta cuando el filtro detecta oportunidad
ai_model_deep: "deepseek-reasoner"

# ===== AGENTES ESPECIALIZADOS (v1.2) =====
# Sistema de agentes que selecciona estrategia según régimen de mercado
ai_agents:
  enabled: true

  # Volatilidad mínima para operar (ATR como % del precio)
  # Si ATR < este valor, el bot NO opera (mercado "muerto")
  # TEMPORAL: Bajado a 0.01 para validar ejecución en testnet
  min_volatility_percent: 0.01

  # Ratio mínimo de volumen vs promedio para confirmar señales
  min_volume_ratio: 0.8

  # Agentes disponibles:
  # - trend_agent: Opera continuación de tendencia en retrocesos
  # - reversal_agent: Opera reversiones en RSI extremo con divergencias

# ===== SELECCIÓN DE MERCADO =====
# Opciones: "crypto", "forex_stocks"
market_type: "crypto"

# ===== CONFIGURACIÓN DE TRADING =====
trading:
  # Activos a operar (lista de símbolos)
  # TIER 1: Máxima liquidez y patrones técnicos claros
  # TIER 2: Buena liquidez, mayor volatilidad = más oportunidades
  symbols:
    # TIER 1 - Core (siempre incluir)
    - "BTC/USDT"    # Rey de la liquidez, patrones muy respetados
    - "ETH/USDT"    # Segunda más líquida, más volátil que BTC
    # TIER 1 - Extendido
    - "SOL/USDT"    # Alta volatilidad, excelente para swing trading
    - "XRP/USDT"    # Muy líquido, movimientos direccionales claros
    # TIER 2 - Opcional (descomentar para más diversificación)
    # - "BNB/USDT"  # Correlación mercado, menos volátil
    # - "AVAX/USDT" # Más volátil, buenos movimientos tendenciales
    # - "LINK/USDT" # Buen actor en mercados alcistas

  # Timeframe para análisis (1m, 5m, 15m, 1h, 4h, 1d)
  timeframe: "1h"

  # Intervalo de escaneo en segundos
  scan_interval: 300  # 5 minutos (testing)

  # Modo de operación: "live", "paper", "backtest"
  mode: "paper"

  # ===== MEJORAS DE LATENCIA =====
  # Análisis paralelo de múltiples símbolos (recomendado si tienes >2 símbolos)
  parallel_analysis: true
  max_parallel_workers: 4  # Número máximo de análisis simultáneos

  # ===== PROTECCIÓN CONTRA SLIPPAGE =====
  # Verificación pre-ejecución: aborta si el precio cambió demasiado desde el análisis
  price_verification:
    enabled: true
    max_deviation_percent: 0.5  # Abortar si precio cambió más de 0.5%

  # Órdenes limit en lugar de market (reduce slippage)
  order_execution:
    use_limit_orders: true
    # Slippage máximo permitido para órdenes limit (% sobre precio de análisis)
    # COMPRA: precio_limit = precio_analisis * (1 + slippage)
    # VENTA: precio_limit = precio_analisis * (1 - slippage)
    max_slippage_percent: 0.3
    # Tiempo máximo para que se llene la orden limit (segundos)
    limit_order_timeout: 30
    # Si la orden limit no se llena, ¿cancelar o convertir a market?
    on_timeout: "cancel"  # "cancel" o "market"

  # ===== DATOS AVANZADOS DE MERCADO (v1.2) =====
  # Datos adicionales que mejoran la calidad de las decisiones
  advanced_data:
    enabled: true

    # Order Book: Detecta muros de compra/venta y presión del mercado
    order_book: true

    # Funding Rate: Sentimiento del mercado de futuros (solo perpetuos)
    # Funding extremo puede indicar reversión inminente
    funding_rate: true

    # Open Interest: Dinero nuevo entrando/saliendo del mercado
    open_interest: true

    # Correlaciones: Relación con BTC y mercados tradicionales
    correlations: true

# ===== GESTIÓN DE RIESGO =====
risk_management:
  # Riesgo máximo por operación (% del capital total)
  max_risk_per_trade: 2.0

  # Drawdown máximo diario permitido (%)
  max_daily_drawdown: 5.0

  # Ratio mínimo riesgo/beneficio
  min_risk_reward_ratio: 1.5

  # Stop loss dinámico (trailing stop)
  use_trailing_stop: true
  trailing_stop_percentage: 3.0

  # Capital inicial para paper trading
  initial_capital: 10000

  # Apalancamiento (solo para algunos exchanges)
  leverage: 1

  # ===== KELLY CRITERION (v1.3) =====
  # Posicionamiento dinámico basado en confianza de la señal
  kelly_criterion:
    enabled: true
    # Fracción de Kelly a usar (0.25 = 1/4 Kelly, conservador)
    # Valores típicos: 0.25 (conservador), 0.5 (moderado), 1.0 (agresivo)
    fraction: 0.25
    # Confianza mínima para operar (0-1)
    min_confidence: 0.5
    # Riesgo máximo permitido incluso con alta confianza
    max_risk_cap: 3.0

# ===== ANÁLISIS TÉCNICO =====
technical_analysis:
  # Indicadores a utilizar
  indicators:
    rsi:
      enabled: true
      period: 14
      overbought: 70
      oversold: 30

    ema:
      enabled: true
      short_period: 50
      long_period: 200

    bollinger_bands:
      enabled: true
      period: 20
      std_dev: 2

    atr:
      enabled: true
      period: 14

    macd:
      enabled: true
      fast_period: 12
      slow_period: 26
      signal_period: 9

# ===== CONFIGURACIÓN DE EXCHANGES =====
exchanges:
  binance:
    enabled: true
    testnet: false
    # Las credenciales se cargan desde .env

  bybit:
    enabled: false
    testnet: false

# ===== CONFIGURACIÓN DE INTERACTIVE BROKERS =====
# (Para trading de acciones y forex)
interactive_brokers:
  enabled: false
  host: "127.0.0.1"
  port: 7497  # 7497 para TWS paper, 7496 para TWS live
  client_id: 1

# ===== SISTEMA DE NOTIFICACIONES =====
notifications:
  telegram:
    enabled: false
    # El token y chat_id se cargan desde .env

  email:
    enabled: false
    # Las credenciales se cargan desde .env

# ===== DATA LOGGING CON INFLUXDB (v1.3) =====
# Almacenamiento de decisiones para análisis y aprendizaje
data_logging:
  enabled: true
  # Las credenciales se cargan desde .env:
  # INFLUXDB_URL, INFLUXDB_TOKEN, INFLUXDB_ORG, INFLUXDB_BUCKET

# ===== WEBSOCKETS (v1.3) =====
# Datos en tiempo real con menor latencia que HTTP polling
websockets:
  enabled: true  # v1.3: ACTIVADO para datos en tiempo real
  # Streams a suscribir (solo activos si enabled: true)
  orderbook: true
  ticker: true
  trades: true
  # Profundidad del order book (5, 10, 20)
  orderbook_depth: 10

# ===== LOGGING Y MONITOREO =====
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  file: "logs/trading_bot.log"
  max_file_size_mb: 10
  backup_count: 5

  # Heartbeat - verificación de que el bot está vivo
  heartbeat_interval: 60  # segundos

# ===== SEGURIDAD =====
security:
  # Kill switch - apaga el bot si se cumple
  kill_switch:
    enabled: true
    max_loss_percentage: 5.0  # % del capital total
    cooldown_period_hours: 24

  # API rate limiting
  api_rate_limit:
    requests_per_minute: 60
    wait_on_limit: true

# ===== BACKTESTING =====
backtesting:
  start_date: "2024-01-01"
  end_date: "2024-12-31"
  initial_capital: 10000
  commission: 0.001  # 0.1%
  slippage: 0.0005   # 0.05%
