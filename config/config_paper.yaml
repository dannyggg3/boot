# ============================================
# CONFIGURACIÓN PAPER (TESTNET) - SATH v1.8.1 INSTITUCIONAL PRO
# Capital: $300 USD
# Nivel: Institucional Máximo (5 estrellas)
# Filosofía: Menos trades, mayor calidad, R/R superior
# Usa Binance Testnet para pruebas sin dinero real
# ============================================

# ===== SELECCIÓN DE PROVEEDOR DE IA =====
ai_provider: "deepseek"
ai_model: "deepseek-chat"

# ===== ARQUITECTURA HÍBRIDA =====
ai_use_hybrid_analysis: true
ai_model_fast: "deepseek-chat"
ai_model_deep: "deepseek-reasoner"

# ===== AGENTES ESPECIALIZADOS =====
ai_agents:
  enabled: true
  # v1.8 INSTITUCIONAL: Solo operar con volatilidad y volumen suficientes
  min_volatility_percent: 0.35  # Mayor volatilidad = mejores oportunidades
  min_volume_ratio: 0.5  # Volumen más alto para confirmar liquidez
  # Reintentos para errores de conexión API
  max_retries: 3
  retry_delay_seconds: 2

# ===== SELECCIÓN DE MERCADO =====
market_type: "crypto"

# ===== CONFIGURACIÓN DE TRADING =====
trading:
  # Con $300: 3 pares líquidos para diversificación moderada
  symbols:
    - "BTC/USDT"  # Alta liquidez, spreads bajos, estable
    - "ETH/USDT"  # Segunda más líquida, buenas tendencias
    - "SOL/USDT"  # Mayor volatilidad = más oportunidades

  timeframe: "15m" # Más señales que 1h
  scan_interval: 180 # 3 minutos para timeframe 15m

  # MODO PAPER - TESTNET (Sin dinero real)
  mode: "paper"

  parallel_analysis: true
  max_parallel_workers: 2

  # Protección contra slippage
  price_verification:
    enabled: true
    max_deviation_percent: 0.3 # Más estricto en live

  order_execution:
    use_limit_orders: true
    max_slippage_percent: 0.2 # Más conservador
    limit_order_timeout: 30
    on_timeout: "cancel"

  advanced_data:
    enabled: true
    order_book: true
    funding_rate: true
    open_interest: true
    correlations: true

# ===== GESTIÓN DE RIESGO - v1.8 INSTITUCIONAL ($300) =====
risk_management:
  # v1.8: Con $300, arriesgar 1.5% = $4.50 por operación
  max_risk_per_trade: 1.5

  # Drawdown máximo diario: 5% = $15
  max_daily_drawdown: 5.0

  # v1.8 CRÍTICO: R/R mínimo de 2.0 para expectativa positiva
  # Con 40% win rate y R/R 2:1 → Expectativa = 0.4*2 - 0.6*1 = +0.2 por trade
  min_risk_reward_ratio: 2.0

  use_trailing_stop: true
  trailing_stop_percentage: 2.0

  # CAPITAL PAPER - $300
  initial_capital: 300

  leverage: 1 # Sin apalancamiento

  # v1.8 Kelly Criterion INSTITUCIONAL ($300)
  # INSTITUCIONAL: Solo trades de alta convicción
  kelly_criterion:
    enabled: true
    fraction: 0.25 # 1/4 Kelly - más agresivo con alta confianza
    min_confidence: 0.70 # Solo opera con >70% confianza (institucional)
    max_risk_cap: 2.5 # Máximo 2.5% en señales muy fuertes

  # v2.0 INSTITUCIONAL SUPERIOR: ATR-based Stop Loss
  # CRÍTICO: Stops basados en volatilidad real para evitar stop-hunts
  # Los institucionales NUNCA usan % fijo - cada activo tiene volatilidad diferente
  atr_stops:
    enabled: true
    sl_multiplier: 2.5      # SL a 2.5x ATR (más espacio para respirar)
    tp_multiplier: 5.0      # TP a 5x ATR (R/R 2:1 garantizado)
    min_distance_percent: 1.8   # CRÍTICO: Mínimo 1.8% (antes 0.5% era stop-hunt)
    max_distance_percent: 6.0   # Máximo 6% para volatilidad extrema

  # v1.8: Session Filter (horarios óptimos de liquidez)
  session_filter:
    enabled: false  # Deshabilitado en paper para más pruebas
    optimal_hours_utc:
      - [7, 16]   # Europa: 7:00-16:00 UTC
      - [13, 22]  # USA: 13:00-22:00 UTC

  # ===== CONTROL DE COMISIONES Y TAMAÑOS MÍNIMOS =====
  fees:
    # Comisión de Binance CON DESCUENTO BNB (25% menos)
    maker_fee_percent: 0.075   # 0.075% con BNB (normal: 0.10%)
    taker_fee_percent: 0.075   # 0.075% con BNB (normal: 0.10%)
    # Round-trip total = 0.15% (ahorro de 25% vs 0.20%)

  position_sizing:
    # v1.8.1 INSTITUCIONAL: Tamaños que justifiquen el trade
    min_position_usd: 40.0     # Mínimo $40 por posición (mayor tamaño = mejor ratio)
    # Con $40: fees = $0.06, ganancia mínima viable = $1.60+

    # Ganancia mínima neta después de fees para ejecutar trade
    min_profit_after_fees_usd: 1.00  # Al menos $1.00 de ganancia neta (más exigente)

    # Factor de seguridad: solo operar si ganancia esperada > fees * factor
    profit_to_fees_ratio: 8.0  # Ganancia esperada debe ser 8x las comisiones
    # Ejemplo: fees $0.12 → necesita ganancia esperada > $0.96

  # Mínimos de Binance por par (notional mínimo)
  exchange_minimums:
    BTC_USDT: 5.0   # $5 mínimo
    ETH_USDT: 5.0   # $5 mínimo
    SOL_USDT: 5.0   # $5 mínimo
    default: 10.0   # $10 para otros pares

# ===== GESTIÓN DE POSICIONES v1.5 =====
position_management:
  enabled: true

  # Método de protección SL/TP
  # "oco" = Exchange maneja automáticamente (recomendado)
  # "local" = Bot monitorea y ejecuta
  protection_mode: "oco"

  # Configuración de órdenes OCO
  oco_settings:
    enabled: true
    sl_limit_buffer_percent: 0.2 # Buffer entre stop trigger y limit price

  # Monitoreo local (fallback si OCO no disponible)
  local_monitoring:
    enabled: true
    check_interval_ms: 500 # Verificar cada 500ms

  # Trailing Stop inteligente - v2.0 INSTITUCIONAL SUPERIOR
  # CRÍTICO: Protege ganancias sin salir prematuramente
  # AJUSTADO: Más espacio para que el trade respire
  trailing_stop:
    enabled: true
    activation_profit_percent: 1.5  # Activar con 1.5% profit (captura más ganancias)
    trail_distance_percent: 1.5     # Trailing 1.5% - balance entre protección y espacio
    # v2.0: Parámetros de seguridad institucional mejorados
    min_profit_to_lock: 0.5         # Asegurar mínimo 0.5% profit al activar
    cooldown_seconds: 10            # 10s entre actualizaciones (evita whipsaws)
    min_safety_margin_percent: 0.6  # Margen de seguridad más amplio

  # Supervisión IA de posiciones
  supervision:
    enabled: true
    check_interval_seconds: 60 # Cada minuto
    # Acciones permitidas (modo moderado/conservador)
    actions_allowed:
      - "HOLD"        # Mantener sin cambios
      - "TIGHTEN_SL"  # Acercar SL para asegurar ganancias
      - "EXTEND_TP"   # Extender TP si momentum fuerte
    # NO incluye PARTIAL_CLOSE ni FULL_CLOSE (solo ajustes)

  # Límites del portfolio - CONSERVADOR para $300
  portfolio:
    max_concurrent_positions: 1    # 1 posición a la vez = mayor tamaño = menos % en fees
    max_exposure_percent: 50       # Máximo 50% del capital ($150) por posición
    max_per_symbol_percent: 50     # Máximo 50% en un solo símbolo
    # Con 1 posición de $150: fees = $0.30, ganancia 4% = $6.00, neto = $5.70

  # Persistencia (SQLite)
  database:
    path: "data/positions.db"

# ===== ANÁLISIS TÉCNICO - v1.8 INSTITUCIONAL =====
technical_analysis:
  # v1.8 INSTITUCIONAL: Mínimo de velas para análisis confiable
  # Más velas = patrones más robustos = menos señales falsas
  min_candles: 150  # Balance entre velocidad y calidad

  indicators:
    rsi:
      enabled: true
      period: 14
      overbought: 70
      oversold: 30
    ema:
      enabled: true
      short_period: 50
      long_period: 200
    bollinger_bands:
      enabled: true
      period: 20
      std_dev: 2
    atr:
      enabled: true
      period: 14
    macd:
      enabled: true
      fast_period: 12
      slow_period: 26
      signal_period: 9

# ===== EXCHANGES =====
exchanges:
  binance:
    enabled: true
    testnet: true  # TESTNET - Paper trading

# ===== NOTIFICACIONES =====
notifications:
  telegram:
    enabled: true # Requiere TELEGRAM_BOT_TOKEN y TELEGRAM_CHAT_ID en .env
  email:
    enabled: false

# ===== DATA LOGGING =====
data_logging:
  enabled: true

# ===== WEBSOCKETS =====
websockets:
  enabled: true
  orderbook: true
  ticker: true
  trades: true
  orderbook_depth: 10

# ===== v1.7: SIMULACIÓN REALISTA PARA PAPER MODE =====
paper_simulation:
  # Latencia de red simulada (ms)
  min_latency_ms: 50
  max_latency_ms: 200

  # Slippage simulado (%)
  base_slippage_percent: 0.05   # Slippage mínimo
  max_slippage_percent: 0.15    # Slippage máximo

  # Tasa de fallos simulados (red, timeout)
  failure_rate: 0.02  # 2% de fallos

# ===== v1.8 INSTITUCIONAL: VALIDACIÓN DE LIQUIDEZ =====
liquidity_validation:
  enabled: true
  max_slippage_percent: 0.3     # Más estricto - máximo 0.3%
  min_spread_warning: 0.15      # Advertir si spread > 0.15%
  max_spread_reject: 0.35       # Rechazar si spread > 0.35%
  min_order_book_depth_usd: 500 # Mínimo $500 en cada lado del order book

# ===== LOGGING =====
logging:
  level: "INFO"
  file: "logs/trading_bot.log"

  # Rotación diaria de logs (a medianoche)
  # Los archivos se nombran: trading_bot.log.2024-12-01, trading_bot.log.2024-12-02, etc.
  backup_count: 30 # Días de logs a mantener

  heartbeat_interval: 60

# ===== SEGURIDAD =====
security:
  kill_switch:
    enabled: true
    max_loss_percentage: 5.0 # $15 de pérdida máxima (5% de $300)
    cooldown_period_hours: 24
  api_rate_limit:
    requests_per_minute: 60
    wait_on_limit: true

# ===== v2.0 INSTITUCIONAL SUPERIOR: MULTI-TIMEFRAME ANALYSIS =====
# CRÍTICO: Solo opera cuando múltiples timeframes están alineados
# AJUSTADO: Menos estricto para capturar entradas antes del movimiento completo
multi_timeframe:
  enabled: true
  higher_timeframe: "4h"   # Tendencia macro - DOMINANTE
  medium_timeframe: "1h"   # Confirmación de momentum
  lower_timeframe: "15m"   # Timing preciso de entrada
  min_alignment_score: 0.65  # 65% mínimo (antes 75% = entradas tardías)
  # Pesos institucionales: TF mayor domina pero menor timing importa más
  weights:
    higher: 0.50  # 50% peso del TF mayor (tendencia principal)
    medium: 0.30  # 30% peso del TF medio
    lower: 0.20   # 20% peso del TF menor (timing más importante)

# ===== v1.7+: FILTRO DE CORRELACIÓN =====
# Evita sobreexposición a activos correlacionados
correlation_filter:
  enabled: true
  max_correlation: 0.70  # No abrir si correlación > 70% con posición existente
  # Correlaciones conocidas (se actualizan dinámicamente)
  correlations:
    "BTC/USDT,ETH/USDT": 0.85
    "BTC/USDT,SOL/USDT": 0.78
    "ETH/USDT,SOL/USDT": 0.82

# ===== v1.8 INSTITUCIONAL: PARÁMETROS ADAPTATIVOS =====
# Ajusta parámetros automáticamente basado en rendimiento
adaptive_parameters:
  enabled: true
  lookback_trades: 30      # Más trades para estadística robusta
  sensitivity: 0.15        # Conservador - cambios graduales
  # Rangos de ajuste INSTITUCIONAL para $300
  ranges:
    min_confidence: { min: 0.65, max: 0.85 }  # Siempre alta confianza
    max_risk_per_trade: { min: 1.0, max: 2.5 }  # Mínimo 1% para que valga la pena
    trailing_activation: { min: 1.5, max: 3.5 }  # Trailing más conservador

# ===== v1.7+: PERFORMANCE ATTRIBUTION =====
# Analiza qué genera más alpha (agente, régimen, hora, etc.)
performance_attribution:
  enabled: true
  log_interval_hours: 24   # Generar reporte cada 24h
