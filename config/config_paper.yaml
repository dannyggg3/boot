# ============================================
# CONFIGURACIÓN PAPER (TESTNET) - SATH v2.1 INSTITUCIONAL PRO
# Capital: $1000 USD
# Nivel: Institucional Máximo (5 estrellas)
# Filosofía: Menos trades, mayor calidad, R/R superior
# OPTIMIZADO: Tamaños de posición viables para ejecución real
# ============================================

# ===== SELECCIÓN DE PROVEEDOR DE IA =====
ai_provider: "deepseek"
ai_model: "deepseek-chat"

# ===== ARQUITECTURA HÍBRIDA =====
ai_use_hybrid_analysis: true
ai_model_fast: "deepseek-chat"
ai_model_deep: "deepseek-reasoner"

# ===== AGENTES ESPECIALIZADOS v2.1 =====
ai_agents:
  enabled: true
  # v2.1 INSTITUCIONAL: Thresholds profesionales
  min_volatility_percent: 0.5   # Volatilidad mínima para movimientos significativos
  min_volume_ratio: 1.0         # CRÍTICO: Mínimo 1.0x (promedio) para confirmar movimientos
  ideal_volume_ratio: 1.3       # Ideal: 1.3x para trades de alta probabilidad
  max_retries: 3
  retry_delay_seconds: 2
  min_adx_trend: 25             # ADX >= 25 = tendencia operable

# ===== SELECCIÓN DE MERCADO =====
market_type: "crypto"

# ===== CONFIGURACIÓN DE TRADING =====
trading:
  # Con $1000: 3 pares líquidos - suficiente capital para diversificar
  symbols:
    - "BTC/USDT"  # Alta liquidez, spreads bajos, estable
    - "ETH/USDT"  # Segunda más líquida, buenas tendencias
    - "SOL/USDT"  # Mayor volatilidad = más oportunidades

  timeframe: "15m"
  scan_interval: 180  # 3 minutos

  mode: "paper"

  parallel_analysis: true
  max_parallel_workers: 3  # Más workers con más capital

  price_verification:
    enabled: true
    max_deviation_percent: 0.3

  order_execution:
    use_limit_orders: true
    max_slippage_percent: 0.2
    limit_order_timeout: 30
    on_timeout: "cancel"

  advanced_data:
    enabled: true
    order_book: true
    funding_rate: true
    open_interest: true
    correlations: true

# ===== GESTIÓN DE RIESGO v2.1 - $1000 INSTITUCIONAL =====
# MATEMÁTICA OPTIMIZADA para posiciones ejecutables
risk_management:
  # v2.1: Con $1000, arriesgar 2.5% = $25 por operación
  # Posición mínima viable con Kelly conservador
  max_risk_per_trade: 2.5

  # Drawdown máximo diario: 8% = $80
  max_daily_drawdown: 8.0

  # R/R mínimo 2:1 para expectativa positiva
  min_risk_reward_ratio: 2.0

  use_trailing_stop: true
  trailing_stop_percentage: 2.0

  # CAPITAL $1000
  initial_capital: 1000

  leverage: 1  # Sin apalancamiento

  # v2.1 Kelly Criterion OPTIMIZADO para $1000
  # CRÍTICO: Fraction más alta para generar posiciones viables
  kelly_criterion:
    enabled: true
    fraction: 0.40      # v2.1: 40% Kelly (de 25%) - posiciones más grandes
    min_confidence: 0.70
    max_risk_cap: 3.0   # Hasta 3% en señales muy fuertes

  # v2.1 ATR-Based Stops - AJUSTADO
  atr_stops:
    enabled: true
    sl_multiplier: 2.0        # v2.1: 2.0x ATR (de 2.5) - SL más ceñido = posición más grande
    tp_multiplier: 4.0        # TP 4x ATR = R/R 2:1 garantizado
    min_distance_percent: 1.5 # Mínimo 1.5%
    max_distance_percent: 5.0 # v2.1: Máximo 5% (de 6%) - evita posiciones microscópicas

  # v2.1 Session Filter
  session_filter:
    enabled: true
    optimal_hours_utc:
      - [7, 16]   # Europa
      - [13, 22]  # USA
    avoid_hours_utc:
      - [0, 6]    # Baja liquidez

  # ===== CONTROL DE COMISIONES - OPTIMIZADO $1000 =====
  fees:
    maker_fee_percent: 0.075
    taker_fee_percent: 0.075

  position_sizing:
    # v2.1: Mínimo más bajo ya que Kelly genera posiciones más grandes
    min_position_usd: 20.0      # De $40 a $20 - más flexible
    min_profit_after_fees_usd: 1.50  # $1.50 mínimo neto
    profit_to_fees_ratio: 6.0   # 6x fees (de 8x) - menos restrictivo

  exchange_minimums:
    BTC_USDT: 5.0
    ETH_USDT: 5.0
    SOL_USDT: 5.0
    default: 10.0

# ===== GESTIÓN DE POSICIONES v2.1 - $1000 =====
position_management:
  enabled: true
  protection_mode: "oco"

  oco_settings:
    enabled: true
    sl_limit_buffer_percent: 0.2

  local_monitoring:
    enabled: true
    check_interval_ms: 500

  # v2.1 Trailing Stop CORREGIDO
  trailing_stop:
    enabled: true
    activation_profit_percent: 2.0
    trail_distance_percent: 1.0
    min_profit_to_lock: 0.8
    cooldown_seconds: 15
    min_safety_margin_percent: 0.5

  supervision:
    enabled: true
    check_interval_seconds: 60
    actions_allowed:
      - "HOLD"
      - "TIGHTEN_SL"
      - "EXTEND_TP"

  # v2.1 Portfolio OPTIMIZADO para $1000
  portfolio:
    max_concurrent_positions: 2    # v2.1: 2 posiciones simultáneas
    max_exposure_percent: 65       # v2.1: 65% (de 50%) = $650 efectivos
    max_per_symbol_percent: 40     # Máximo 40% por símbolo = $400
    # MATEMÁTICA: $650 × 2.5% risk ÷ 5% SL = posición ~$325 ✓

  database:
    path: "data/positions.db"

# ===== ANÁLISIS TÉCNICO v2.1 =====
technical_analysis:
  min_candles: 150

  indicators:
    rsi:
      enabled: true
      period: 14
      overbought: 70
      oversold: 30
    ema:
      enabled: true
      short_period: 50
      long_period: 200
    bollinger_bands:
      enabled: true
      period: 20
      std_dev: 2
    atr:
      enabled: true
      period: 14
    macd:
      enabled: true
      fast_period: 12
      slow_period: 26
      signal_period: 9
    # v2.1: ADX habilitado para detección de tendencia
    adx:
      enabled: true
      period: 14

# ===== EXCHANGES =====
exchanges:
  binance:
    enabled: true
    testnet: true

# ===== NOTIFICACIONES =====
notifications:
  telegram:
    enabled: true
  email:
    enabled: false

# ===== DATA LOGGING =====
data_logging:
  enabled: true

# ===== WEBSOCKETS =====
websockets:
  enabled: true
  orderbook: true
  ticker: true
  trades: true
  orderbook_depth: 10

# ===== SIMULACIÓN PAPER =====
paper_simulation:
  min_latency_ms: 50
  max_latency_ms: 200
  base_slippage_percent: 0.05
  max_slippage_percent: 0.15
  failure_rate: 0.02

# ===== VALIDACIÓN DE LIQUIDEZ =====
liquidity_validation:
  enabled: true
  max_slippage_percent: 0.3
  min_spread_warning: 0.15
  max_spread_reject: 0.35
  min_order_book_depth_usd: 500

# ===== LOGGING =====
logging:
  level: "INFO"
  file: "logs/trading_bot.log"
  backup_count: 30
  heartbeat_interval: 60

# ===== SEGURIDAD =====
security:
  kill_switch:
    enabled: true
    max_loss_percentage: 8.0  # $80 de pérdida máxima
    cooldown_period_hours: 24
  api_rate_limit:
    requests_per_minute: 60
    wait_on_limit: true

# ===== MULTI-TIMEFRAME v2.1 =====
multi_timeframe:
  enabled: true
  higher_timeframe: "4h"
  medium_timeframe: "1h"
  lower_timeframe: "15m"
  min_alignment_score: 0.65
  weights:
    higher: 0.50
    medium: 0.30
    lower: 0.20

# ===== FILTRO DE CORRELACIÓN =====
correlation_filter:
  enabled: true
  max_correlation: 0.70
  correlations:
    "BTC/USDT,ETH/USDT": 0.85
    "BTC/USDT,SOL/USDT": 0.78
    "ETH/USDT,SOL/USDT": 0.82

# ===== PARÁMETROS ADAPTATIVOS v2.1 =====
adaptive_parameters:
  enabled: true
  lookback_trades: 30
  sensitivity: 0.15
  ranges:
    min_confidence: { min: 0.65, max: 0.85 }
    max_risk_per_trade: { min: 1.5, max: 3.0 }
    trailing_activation: { min: 1.5, max: 3.5 }

# ===== PERFORMANCE ATTRIBUTION =====
performance_attribution:
  enabled: true
  log_interval_hours: 24
